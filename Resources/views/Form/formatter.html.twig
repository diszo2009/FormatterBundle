{% block sonata_formatter_type_widget %}
    <div class="row-fluid">
        {{ form_widget(form.children[format_field]) }}
    </div>
    <div class="row-fluid sepH_c">
        <div class="span12">
            <i>{{ "please_select_format_method"|trans({}, "SonataFormatterBundle") }}</i>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            {{ form_widget(form.children[source_field]) }}
        </div>
    </div>
    <script>
        var {{ source_id }}_rich_instance = false;

        jQuery(document).ready(function() {

            // This code requires CKEDITOR
            if (typeof CKEDITOR === 'undefined') {
                console.log('RzFormatterBundle requires CKEditor Installed.');
                return;
            }

            jQuery('#{{ form.children[format_field].vars.id }}').change(function() {
                var elms = jQuery('#{{ form.children[source_field].vars.id }}');

                if ({{ source_id }}_rich_instance) {
                    {{ source_id }}_rich_instance.destroy();
                }

                var val = jQuery(this).val();
                switch(val) {
                    case 'markdown':
                        {{ source_id }}_rich_instance = CKEDITOR.replace('{{ form.children[source_field].vars.id }}', {
                            autoGrow_onStartup: true,
                            autoGrow_maxHeight: 700,
                            autoGrow_minHeight: 300,
                            autoGrow_bottomSpace: 200,
                            resize_enabled: true,
                            startupMode : 'source',
                            toolbar: [['Maximize']]
                        });
                        break;
                    case 'twig':
                        {{ source_id }}_rich_instance = CKEDITOR.replace('{{ form.children[source_field].vars.id }}', {
                            autoGrow_onStartup: true,
                            autoGrow_maxHeight: 700,
                            autoGrow_minHeight: 300,
                            autoGrow_bottomSpace: 200,
                            startupMode : 'source',
                            toolbar: [['Maximize']]
                        });
                        break;
                    case 'rawhtml':
                        {{ source_id }}_rich_instance = CKEDITOR.replace('{{ form.children[source_field].vars.id }}', {
                            autoGrow_onStartup: true,
                            autoGrow_maxHeight: 700,
                            autoGrow_minHeight: 300,
                            autoGrow_bottomSpace: 200,
                            startupMode : 'source',
                            toolbar: [['Maximize']]
                        });
                        break;
                    case 'richhtml':
                        {{ source_id }}_rich_instance = CKEDITOR.replace('{{ form.children[source_field].vars.id }}', {
                            autoGrow_onStartup: true,
                            autoGrow_maxHeight: 700,
                            autoGrow_minHeight: 300,
                            autoGrow_bottomSpace: 200,
                            allowedContent: true,
                            toolbar: [
                                [ "Source", "Maximize", "ShowBlocks" ],
                                [ "Format", "Font","FontSize" ],
                                [ "Bold","Italic","Underline", "-", "NumberedList","BulletedList" ],
                                [ "Image","Flash","Table","PageBreak" ],
                                [ "Cut","Copy","Paste","PasteText","-","Undo","Redo" ]
                            ]
                        });
                }
            });

            jQuery('#{{ form.children[format_field].vars.id }}').trigger('change');
        });
    </script>
{% endblock sonata_formatter_type_widget %}
